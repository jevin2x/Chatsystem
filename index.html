<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2-Person Realtime Chat</title>
<style>
  body { font-family: Arial; max-width:600px; margin:30px auto; }
  #chat { border:1px solid #ccc; height:400px; overflow:auto; padding:10px; display:flex; flex-direction:column; gap:6px; }
  .left { align-self:flex-start; background:#e0e0e0; padding:8px 12px; border-radius:12px; max-width:70%; }
  .right { align-self:flex-end; background:#60a5fa; color:white; padding:8px 12px; border-radius:12px; max-width:70%; }
  input { width:70%; padding:8px; margin-bottom:6px; }
  button { padding:8px; margin-bottom:6px; }
  #setup { margin-bottom:10px; }
</style>
</head>
<body>

<h2>2-Person Realtime Chat</h2>

<div id="setup">
  <input id="username" placeholder="Enter your name">
  <button id="setName">Set Name</button>
</div>

<div id="chat"></div>

<div id="composer" class="hide">
  <input id="msg" placeholder="Type a message..." />
  <button id="send">Send</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // ðŸ”¹ Firebase Config
  var firebaseConfig = {
    apiKey: "AIzaSyAf1rx_kVNQ7kfnhm5yn3mlsf3jHFP7xF0",
    authDomain: "chatsystem-001.firebaseapp.com",
    databaseURL: "https://chatsystem-001-default-rtdb.firebaseio.com",
    projectId: "chatsystem-001",
    storageBucket: "chatsystem-001.firebasestorage.app",
    messagingSenderId: "20781486614",
    appId: "1:20781486614:web:6db9555f47ea2223c45b37"
  };
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();

  const chatBox = document.getElementById('chat');
  const msgInput = document.getElementById('msg');

  // Load name from localStorage if exists
  let username = localStorage.getItem('chat_name') || "";

  if(username !== "") {
    document.getElementById('username').value = username;
    document.getElementById('username').disabled = true;
    document.getElementById('setName').disabled = true;
    document.getElementById('composer').classList.remove('hide');
  }

  // Set name permanently
  document.getElementById('setName').onclick = function() {
    let name = document.getElementById('username').value.trim();
    if(name === "") return;
    username = name;
    localStorage.setItem('chat_name', username); // store permanently
    document.getElementById('username').disabled = true;
    document.getElementById('setName').disabled = true;
    document.getElementById('composer').classList.remove('hide');
  }

  // Send message
  document.getElementById('send').onclick = function() {
    let text = msgInput.value.trim();
    if(text === "" || username === "") return;
    db.ref("messages").push({
      sender: username,
      text: text,
      timestamp: Date.now()
    });
    msgInput.value = "";
  }

  // Listen for messages
  db.ref("messages").on("child_added", function(snapshot) {
    const data = snapshot.val();
    const div = document.createElement('div');
    div.textContent = data.sender + ": " + data.text;
    // Align right if sender is you, left if other person
    div.className = (data.sender === username) ? 'right' : 'left';
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>

</body>
</html>
